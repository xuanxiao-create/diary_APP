<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ—¥ç¯è®° - è§’è‰²ç³»ç»Ÿä¿®å¤å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #3b82f6; background-color: #f8fafc; }
        .success { color: #16a34a; }
        .error { color: #dc2626; }
        .warning { color: #d97706; }
        .info { color: #2563eb; }
        button { background-color: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #2563eb; }
        button.danger { background-color: #dc2626; }
        button.danger:hover { background-color: #b91c1c; }
        button.success { background-color: #16a34a; }
        button.success:hover { background-color: #15803d; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .result.success { background-color: #dcfce7; color: #166534; }
        .result.error { background-color: #fef2f2; color: #991b1b; }
        .result.info { background-color: #dbeafe; color: #1e40af; }
        .credentials { background-color: #f3f4f6; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .credentials strong { color: #1f2937; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ æ—¥ç¯è®°è§’è‰²ç³»ç»Ÿä¿®å¤å·¥å…·</h1>
            <p>è§£å†³ç®¡ç†å‘˜è´¦å·å’Œè§’è‰²æ˜¾ç¤ºé—®é¢˜</p>
        </div>

        <div class="step">
            <h3>ğŸ“‹ é—®é¢˜è¯Šæ–­</h3>
            <p>æ‚¨é‡åˆ°çš„é—®é¢˜ï¼š</p>
            <ul>
                <li>âŒ æ³¨å†Œäº† <code>admin/123456</code> ä½†æ— æ³•æ­£å¸¸ä½¿ç”¨</li>
                <li>âŒ ç™»å½•åæ²¡æœ‰çœ‹åˆ°ç”¨æˆ·è§’è‰²ç³»ç»Ÿ</li>
                <li>âœ… æ­£ç¡®çš„ç®¡ç†å‘˜è´¦å·åº”è¯¥æ˜¯ <code>admin/admin123</code></li>
            </ul>
        </div>

        <div class="step">
            <h3>ğŸ”§ ä¸€é”®ä¿®å¤</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è‡ªåŠ¨ä¿®å¤æ‰€æœ‰é—®é¢˜ï¼š</p>
            <button onclick="fixAllIssues()" class="success">ğŸš€ ä¸€é”®ä¿®å¤æ‰€æœ‰é—®é¢˜</button>
            <div id="fix-result"></div>
        </div>

        <div class="step">
            <h3>ğŸ“ æ‰‹åŠ¨ä¿®å¤æ­¥éª¤</h3>
            <p>å¦‚æœè‡ªåŠ¨ä¿®å¤å¤±è´¥ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
            <ol>
                <li><button onclick="createCorrectAdmin()">åˆ›å»ºæ­£ç¡®çš„ç®¡ç†å‘˜è´¦å· (admin/admin123)</button></li>
                <li><button onclick="clearWrongAdmin()">åˆ é™¤é”™è¯¯çš„ç®¡ç†å‘˜è´¦å· (admin/123456)</button></li>
                <li><button onclick="verifySystem()">éªŒè¯ä¿®å¤ç»“æœ</button></li>
            </ol>
            <div id="manual-result"></div>
        </div>

        <div class="step">
            <h3>ğŸ”‘ æ­£ç¡®çš„ç™»å½•ä¿¡æ¯</h3>
            <div class="credentials">
                <strong>ç®¡ç†å‘˜è´¦å·ï¼š</strong> admin / admin123<br>
                <strong>æ™®é€šç”¨æˆ·ï¼š</strong> demo / 123456<br>
                <strong>âš ï¸ æ³¨æ„ï¼š</strong> ç®¡ç†å‘˜å¯†ç æ˜¯ <code>admin123</code>ï¼Œä¸æ˜¯ <code>123456</code>
            </div>
        </div>

        <div class="step">
            <h3>ğŸ¯ è§’è‰²ç³»ç»ŸåŠŸèƒ½</h3>
            <p>ä¿®å¤åæ‚¨å°†çœ‹åˆ°ï¼š</p>
            <ul>
                <li>âœ… ç”¨æˆ·åæ—è¾¹æ˜¾ç¤ºè§’è‰²å¾½ç« ï¼ˆç®¡ç†å‘˜/ç”¨æˆ·/æ¸¸å®¢ï¼‰</li>
                <li>âœ… ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°"ç®¡ç†"æŒ‰é’®</li>
                <li>âœ… ç®¡ç†å‘˜å¯ä»¥è®¿é—®ç®¡ç†å‘˜é¢æ¿</li>
                <li>âœ… ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„è§’è‰²</li>
            </ul>
        </div>

        <div class="step">
            <h3>ğŸ§ª æµ‹è¯•éªŒè¯</h3>
            <p>ä¿®å¤å®Œæˆåï¼Œè¯·ï¼š</p>
            <ol>
                <li>è¿”å›ä¸»åº”ç”¨ï¼š<a href="index.html" target="_blank">æ‰“å¼€æ—¥ç¯è®°APP</a></li>
                <li>ä½¿ç”¨ <code>admin/admin123</code> ç™»å½•</li>
                <li>ç¡®è®¤ç”¨æˆ·åæ—è¾¹æ˜¾ç¤º"ç®¡ç†å‘˜"å¾½ç« </li>
                <li>ç¡®è®¤å¯ä»¥çœ‹åˆ°"ç®¡ç†"æŒ‰é’®</li>
            </ol>
        </div>

        <div class="step">
            <h3>ğŸ†˜ ç´§æ€¥é‡ç½®</h3>
            <p>å¦‚æœä»ç„¶æœ‰é—®é¢˜ï¼Œå¯ä»¥é‡ç½®æ‰€æœ‰æ•°æ®ï¼š</p>
            <button onclick="resetAllData()" class="danger">âš ï¸ é‡ç½®æ‰€æœ‰æ•°æ®</button>
            <div id="reset-result"></div>
        </div>
    </div>

    <script>
        // ä¸€é”®ä¿®å¤æ‰€æœ‰é—®é¢˜
        function fixAllIssues() {
            const result = document.getElementById('fix-result');
            result.innerHTML = '<div class="result info">ğŸ”„ æ­£åœ¨ä¿®å¤...</div>';
            
            try {
                // è·å–å½“å‰ç”¨æˆ·æ•°æ®
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                let adminExists = false;
                let wrongAdminExists = false;
                
                // æ£€æŸ¥å¹¶ä¿®å¤ç®¡ç†å‘˜è´¦å·
                users.forEach(user => {
                    if (user.username === 'admin') {
                        adminExists = true;
                        if (user.password === '123456') {
                            wrongAdminExists = true;
                            user.password = 'admin123';
                            user.role = 'admin';
                        }
                    }
                });
                
                // å¦‚æœæ²¡æœ‰adminç”¨æˆ·ï¼Œåˆ›å»ºä¸€ä¸ª
                if (!adminExists) {
                    users.push({
                        id: 'admin_' + Date.now(),
                        username: 'admin',
                        email: 'admin@example.com',
                        password: 'admin123',
                        role: 'admin',
                        created_at: new Date().toISOString()
                    });
                }
                
                // ç¡®ä¿æœ‰demoç”¨æˆ·
                let demoExists = users.find(u => u.username === 'demo');
                if (!demoExists) {
                    users.push({
                        id: 'demo_' + Date.now(),
                        username: 'demo',
                        email: 'demo@example.com',
                        password: '123456',
                        role: 'user',
                        created_at: new Date().toISOString()
                    });
                }
                
                // ä¿å­˜ä¿®å¤åçš„æ•°æ®
                localStorage.setItem('registeredUsers', JSON.stringify(users));
                
                // æ¸…é™¤å½“å‰ç”¨æˆ·ï¼ˆå¦‚æœç™»å½•äº†é”™è¯¯çš„è´¦å·ï¼‰
                localStorage.removeItem('currentUser');
                
                let message = '<div class="result success">âœ… ä¿®å¤å®Œæˆï¼</div>';
                message += '<p><strong>ä¿®å¤å†…å®¹ï¼š</strong></p><ul>';
                
                if (wrongAdminExists) {
                    message += '<li>âœ… å·²å°†ç®¡ç†å‘˜å¯†ç ä» 123456 ä¿®æ”¹ä¸º admin123</li>';
                }
                if (!adminExists) {
                    message += '<li>âœ… å·²åˆ›å»ºç®¡ç†å‘˜è´¦å· admin/admin123</li>';
                }
                if (!demoExists) {
                    message += '<li>âœ… å·²åˆ›å»ºdemoè´¦å· demo/123456</li>';
                }
                message += '<li>âœ… å·²æ¸…é™¤é”™è¯¯çš„ç™»å½•çŠ¶æ€</li>';
                message += '</ul>';
                message += '<p><strong>ç°åœ¨è¯·ä½¿ç”¨ä»¥ä¸‹è´¦å·ç™»å½•ï¼š</strong></p>';
                message += '<div class="credentials">';
                message += '<strong>ç®¡ç†å‘˜ï¼š</strong> admin / admin123<br>';
                message += '<strong>æ™®é€šç”¨æˆ·ï¼š</strong> demo / 123456';
                message += '</div>';
                
                result.innerHTML = message;
                
            } catch (error) {
                result.innerHTML = '<div class="result error">âŒ ä¿®å¤å¤±è´¥ï¼š' + error.message + '</div>';
            }
        }

        // åˆ›å»ºæ­£ç¡®çš„ç®¡ç†å‘˜è´¦å·
        function createCorrectAdmin() {
            const result = document.getElementById('manual-result');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰adminç”¨æˆ·
            let adminUser = users.find(u => u.username === 'admin');
            
            if (adminUser) {
                adminUser.password = 'admin123';
                adminUser.role = 'admin';
                result.innerHTML = '<div class="result success">âœ… å·²æ›´æ–°ç®¡ç†å‘˜è´¦å·å¯†ç ä¸º admin123</div>';
            } else {
                adminUser = {
                    id: 'admin_' + Date.now(),
                    username: 'admin',
                    email: 'admin@example.com',
                    password: 'admin123',
                    role: 'admin',
                    created_at: new Date().toISOString()
                };
                users.push(adminUser);
                result.innerHTML = '<div class="result success">âœ… å·²åˆ›å»ºç®¡ç†å‘˜è´¦å· admin/admin123</div>';
            }
            
            localStorage.setItem('registeredUsers', JSON.stringify(users));
        }

        // åˆ é™¤é”™è¯¯çš„ç®¡ç†å‘˜è´¦å·
        function clearWrongAdmin() {
            const result = document.getElementById('manual-result');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            
            // è¿‡æ»¤æ‰å¯†ç ä¸º123456çš„adminç”¨æˆ·
            const filteredUsers = users.filter(user => {
                if (user.username === 'admin' && user.password === '123456') {
                    return false; // åˆ é™¤è¿™ä¸ªç”¨æˆ·
                }
                return true; // ä¿ç•™å…¶ä»–ç”¨æˆ·
            });
            
            if (filteredUsers.length < users.length) {
                localStorage.setItem('registeredUsers', JSON.stringify(filteredUsers));
                result.innerHTML = '<div class="result success">âœ… å·²åˆ é™¤é”™è¯¯çš„ç®¡ç†å‘˜è´¦å· (admin/123456)</div>';
            } else {
                result.innerHTML = '<div class="result info">â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°é”™è¯¯çš„ç®¡ç†å‘˜è´¦å·</div>';
            }
        }

        // éªŒè¯ç³»ç»Ÿ
        function verifySystem() {
            const result = document.getElementById('manual-result');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const admin = users.find(u => u.username === 'admin');
            
            let message = '<div class="result info">ğŸ“Š éªŒè¯ç»“æœï¼š</div>';
            message += '<ul>';
            
            if (admin) {
                if (admin.password === 'admin123') {
                    message += '<li class="success">âœ… ç®¡ç†å‘˜è´¦å·å­˜åœ¨ä¸”å¯†ç æ­£ç¡® (admin/admin123)</li>';
                } else {
                    message += '<li class="error">âŒ ç®¡ç†å‘˜è´¦å·å­˜åœ¨ä½†å¯†ç é”™è¯¯ï¼Œå½“å‰å¯†ç ï¼š' + admin.password + '</li>';
                }
                message += '<li class="success">âœ… ç®¡ç†å‘˜è§’è‰²ï¼š' + admin.role + '</li>';
            } else {
                message += '<li class="error">âŒ ç®¡ç†å‘˜è´¦å·ä¸å­˜åœ¨</li>';
            }
            
            const demo = users.find(u => u.username === 'demo');
            if (demo) {
                message += '<li class="success">âœ… Demoè´¦å·å­˜åœ¨ (demo/123456)</li>';
            } else {
                message += '<li class="warning">âš ï¸ Demoè´¦å·ä¸å­˜åœ¨</li>';
            }
            
            message += '</ul>';
            result.innerHTML = message;
        }

        // é‡ç½®æ‰€æœ‰æ•°æ®
        function resetAllData() {
            const result = document.getElementById('reset-result');
            
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ç”¨æˆ·ã€ä»»åŠ¡å’Œè®¾ç½®ï¼')) {
                localStorage.clear();
                result.innerHTML = '<div class="result success">âœ… æ‰€æœ‰æ•°æ®å·²é‡ç½®ã€‚åˆ·æ–°é¡µé¢åç³»ç»Ÿå°†é‡æ–°åˆ›å»ºé»˜è®¤æ•°æ®ã€‚</div>';
                
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨éªŒè¯
        window.onload = function() {
            verifySystem();
        };
    </script>
</body>
</html>